# fluxbox startup file
#
# By this point, X has called startfluxbox.
# The goal of this file is to:
#    * set a custom fluxbox environment
#    * start apps before starting fluxbox
#    * start fluxbox

# Use custom built fluxbox.
export PATH=/opt/fluxbox/bin:$HOME/bin:$PATH

# Set a solid black background.
fbsetroot -solid black

# Set GNOME's background.
bash <<EOF &
gsettings set org.gnome.desktop.background color-shading-type solid
gsettings set org.gnome.desktop.background picture-options zoom
gsettings set org.gnome.desktop.background picture-uri 'file:///usr/share/backgrounds/Precise_Pangolin_by_Vlad_Gerasimov.jpg'
gsettings set org.gnome.desktop.background primary-color '#3465a4'
gsettings set org.gnome.desktop.background picture-options zoom
sleep 2
gsettings set org.gnome.desktop.background color-shading-type solid
gsettings set org.gnome.desktop.background picture-options none
gsettings set org.gnome.desktop.background picture-uri ''
gsettings set org.gnome.desktop.background primary-color '#000000000000'
EOF

# Ensure GNOME keyboard layout is set correctly for Super key.
# In particular, ensure fluxbox Super keys are not clobbered by GNOME.
bash <<EOF &
gsettings set org.gnome.libgnomekbd.keyboard options "['ctrl\tctrl:nocaps']"
sleep 1
gsettings set org.gnome.libgnomekbd.keyboard options "['ctrl\tctrl:nocaps', 'altwin\taltwin:hyper_win']"
EOF

thunar --daemon &
xfce4-power-manager --no-daemon &
gnome-sound-applet &
gnome-screensaver-watch &
bash -c 'sleep 10; exec gnome-do' &
bash -c 'sleep 300; killall update-notifier' &
screens &

notice `uname -n` fluxbox is starting
trap 'notice `uname -n` fluxbox is stopping' 0 INT TERM QUIT EXIT

# Print traps to stdio for X log.
trap

fluxbox
