#!/usr/bin/env bash
# Install Go (golang).

PREFIX="$REQD_OPT"/go
PACKAGES="mvdan.cc/sh/v3/cmd/shfmt"

check() {
    reqd_ls "$PREFIX"/bin/go
    reqd_run_once
}

install() {
    rm -fr "$PREFIX"

    qwertyrc > go.qwertyrc
    "$REQD_BIN"/qwerty.sh --rc go.qwertyrc

    cd "$REQD_OPT"
    tar -xvzf "$REQD_RES"/go.tar.gz

    "$PREFIX"/bin/go version

    for package in $PACKAGES; do
        GO111MODULE=on "$PREFIX"/bin/go get "$package"
    done
}

qwertyrc() {
    cat - <<EOF
# GNU/Linux 64-bit
  --sys=linux --arch=x86_64 \\
  --output=go.tar.gz \\
  --sha256=5c566ddc2e0bcfc25c26a5dc44a440fcc0177f7350c1f01952b34d5989a0d287 \\
  https://dl.google.com/go/go1.14.6.linux-amd64.tar.gz

# GNU/Linux on ARM
  --sys=linux --arch=arm --all-sub-arch \\
  --output=go.tar.gz \\
  --sha256=cab39cc0fdf9731476a339af9d7bcd8fc661bfa323abb1ce9d1633fb31daeb07 \\
  https://dl.google.com/go/go1.14.6.linux-armv6l.tar.gz

# Mac OS X, 64-bit
  --sys=darwin --arch=x86_64 \\
  --sha256=4832c7b6b9a2a225c557d5e8d66928230a5a8405e705ace53f6ed0ee79ddb3c4 \\
  --output=go.tar.gz \\
  https://dl.google.com/go/go1.14.6.darwin-amd64.tar.gz
EOF
}

reqd_main "$@"
